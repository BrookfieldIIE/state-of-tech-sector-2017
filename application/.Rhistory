else{
length_code <- length
}
final_vector <- c()
if(length(length_code) >= 3){
two_letter <- str_sub(code,1,2)
print(two_letter)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length(length_code) >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length(length_code) >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter],`Class title`)
if(length(length_code) >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter],`Class title`)
}
}
}
}
return(final_vector)
}
convert_one_code("111")
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- length(code)
}
final_vector <- c()
if(length(length_code) >= 3){
two_letter <- str_sub(code,1,2)
print(two_letter)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length(length_code) >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length(length_code) >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter],`Class title`)
if(length(length_code) >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter],`Class title`)
}
}
}
}
return(final_vector)
}
convert_one_code("111")
convert_one_code("1111")
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- length(code)
}
final_vector <- c()
print("here")
if(length(length_code) >= 3){
two_letter <- str_sub(code,1,2)
print(two_letter)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length(length_code) >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length(length_code) >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter],`Class title`)
if(length(length_code) >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter],`Class title`)
}
}
}
}
return(final_vector)
}
convert_one_code("1111")
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- length(code)
}
final_vector <- c()
print("here")
if(length_code >= 3){
two_letter <- str_sub(code,1,2)
print(two_letter)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length_code >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length_code >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter],`Class title`)
if(length_code >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter],`Class title`)
}
}
}
}
return(final_vector)
}
convert_one_code("1111")
length("1111")
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- str_length(code)
}
final_vector <- c()
print("here")
if(length_code >= 3){
two_letter <- str_sub(code,1,2)
print(two_letter)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length_code >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length_code >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter],`Class title`)
if(length_code >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter],`Class title`)
}
}
}
}
return(final_vector)
}
length("1111")
convert_one_code("1111")
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- str_length(code)
}
final_vector <- c()
if(length_code >= 3){
two_letter <- str_sub(code,1,2)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length_code >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length_code >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter],`Class title`)
if(length_code >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter],`Class title`)
}
}
}
}
return(final_vector)
}
convert_one_code("1111")
convert_one_code("111111")
convert_one_code("111112")
convert_one_code("111113")
convert_one_code("111110")
convert_one_code("11110")
convert_one_code("111110")
convert_one_code("1113")
convert_one_code("11114")
convert_one_code("1121")
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- str_length(code)
}
final_vector <- c()
if(length_code >= 3){
two_letter <- str_sub(code,1,2)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length_code >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length_code >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter,`Class title`])
if(length_code >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter,`Class title`])
}
}
}
}
return(final_vector)
}
convert_one_code("11114")
convert_one_code("11114")[1]
convert_one_code("11114")[2]
convert_one_code <- function(code,length=NA){
require(stringr)
sequence <- seq(2,str_length(code))
extract_code <- function(number){
return(str_sub(code,1,number))
}
code_list <- lapply(sequence,extract_code)
return(code_list)
}
convert_one_code("1111")
convert_one_code <- function(code,length=NA){
require(stringr)
sequence <- seq(2,str_length(code))
extract_code <- function(number){
return(str_sub(code,1,number))
}
code_list <- lapply(sequence,extract_code)
extract_name <- function(code_2){
return(NAICS[Code==code_2,`Class title`])
}
name_list <- lapply(code_list,extract_name)
return(name_list)
}
convert_one_code("1111")
install.packages("microbenchmark")
require(microbenchmark)
help(runif)
convert_one_code_2 <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- str_length(code)
}
final_vector <- c()
if(length_code >= 3){
two_letter <- str_sub(code,1,2)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length_code >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length_code >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter,`Class title`])
if(length_code >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter,`Class title`])
}
}
}
}
return(final_vector)
}
microbenchmark(convert_one_code("111111"),convert_once_code_2("111111"))
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"))
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"))
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"))
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"))
help(microbenchmark)
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"), times=1000)
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"), times=1000)
convert_one_code <- function(code,length=NA){
require(stringr)
sequence <- seq(2,str_length(code))
extract_name <- function(number){
return(NAICS[Code==str_sub(code,1,number),`Class title`])
}
name_list <- lapply(sequence,extract_name)
return(name_list)
}
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"), times=1000)
convert_one_code <- function(code,length=NA){
require(stringr)
extract_name <- function(number){
return(NAICS[Code==str_sub(code,1,number),`Class title`])
}
return(lapply(seq(2,str_length(code)),extract_name))
}
microbenchmark(convert_one_code("111111"),convert_one_code_2("111111"), times=1000)
show_NAICS <- function(vector_of_codes){
require(stringr)
return(lapply(vector_of_codes,convert_one_code))
}
show_NAICS_2  <- function(vector_of_codes){
require(stringr)
return(lapply(vector_of_codes,convert_one_code_2))
}
convert_one_code <- function(code,length=NA){
require(stringr)
extract_name <- function(number){
return(NAICS[Code==str_sub(code,1,number),`Class title`])
}
return(lapply(seq(2,str_length(code)-1),extract_name))
}
vector_thing <- c("111111","45231","611630","541710","45114")
microbenchmark(show_NAICS(vector_thing),show_NAICS_2(vector_thing))
microbenchmark(show_NAICS(vector_thing),show_NAICS_2(vector_thing),times=1000)
microbenchmark(show_NAICS(vector_thing),show_NAICS_2(vector_thing),times=1000)
convert_one_code <- function(code,length=NA){
require(stringr)
length_code <- length
if(is.na(length)){
length_code <- str_length(code)
}
final_vector <- c()
if(length_code >= 3){
two_letter <- str_sub(code,1,2)
final_vector <- c(final_vector,NAICS[Code==two_letter,`Class title`])
if(length_code >= 4){
three_letter <- str_sub(code,1,3)
final_vector <- c(final_vector,NAICS[Code==three_letter,`Class title`])
if(length_code >= 5){
four_letter <- str_sub(code,1,4)
final_vector <- c(final_vector,NAICS[Code==four_letter,`Class title`])
if(length_code >= 6){
five_letter <- str_sub(code,1,5)
final_vector <- c(final_vector, NAICS[Code==five_letter,`Class title`])
}
}
}
}
return(final_vector)
}
convert_one_name <- function(name){
return(max(NAICS[`Class title`==name,Code]))
}
convert_all_names <- function(vector_of_names){
return(lapply(vector_of_names,convert_one_name))
}
convert_one_name("Sewing, needlework and piece goods stores")
all_names <- convert_all_names(test_1[NAICS])
all_names <- convert_all_names(test_1[mNAICS])
all_names <- convert_all_names(test_1[,NAICS])
warnings()
show_NAICS  <- function(vector_of_codes){
require(stringr)
return(sapply(vector_of_codes,convert_one_code))
}
vector_thing <- c("111111","45231","611630","541710","45114")
show_NAICS(vector_thing)
show_NAICS  <- function(vector_of_codes){
require(stringr)
return(lapply(vector_of_codes,convert_one_code))
}
microbenchmark(convert_one_name("Sporting goods, hobby, book and music stores"),times=10000)
setkey(NAICS,`Class title`)
microbenchmark(convert_one_name("Sporting goods, hobby, book and music stores"),times=10000)
View(NAICS)
help(setkey)
setkey(NAICS,c(`Class title`,`Code`))
setkey(NAICS,c("Class title","Code"))
setkey(NAICS,"Class title","Code")
microbenchmark(convert_one_name("Sporting goods, hobby, book and music stores"),times=10000)
help(last)
convert_one_name <- function(name){
return(last(NAICS[`Class title`==name,Code]))
}
microbenchmark(convert_one_name("Sporting goods, hobby, book and music stores"),times=10000)
help(last)
microbenchmark(convert_one_name("Sporting goods, hobby, book and music stores"),times=10000)
all_names <- convert_all_names(test_1[,NAICS])
convert_all_names <- function(vector_of_names){
return(sapply(vector_of_names,convert_one_name))
}
all_names <- convert_all_names(test_1[,NAICS])
help(mtcars)
View(NAICS)
View(NAICS)
View(NAICS)
length(unique(test_1[,CATEGORY]))
test_1 <- test_1[CATEGORY=="Investment"]
View(test_1)
unique(test_1[,COMPONENT])
View(NAICS)
NAICS_dic<-NAICS
rm(NAICS)
setkey(NAICS_dic,"Class title")
setkey(test_1,NAICS)
test_5 <- test_1[NAICS_dic,nomatch=0]
View(test_5)
source("test_function.R")
source("test_function.R")
rm(test_5)
View(test_1)
test_1[,COMPONENT:=str_replace(COMPONENT," (x 1,000,000)","")]
View(test_1)
View(test_1)
unique(test_1[,COMPONENT])
test_1[,COMPONENT:=str_replace(COMPONENT," (x 1,000,000)","")]
View(test_1)
test_1[,COMPONENT:=str_replace(COMPONENT,' (x 1,000,000)',"")]
View(test_1)
str_replace("Total non-residential (x 1,000,000)"." (x 1,000,000)","")
str_replace("Total non-residential (x 1,000,000)"." (x 1,000,000)","")
str_replace("Total non-residential (x 1,000,000)"," (x 1,000,000)","")
str_replace("Total non-residential (x 1,000,000)","(x 1,000,000)","")
str_replace("Total non-residential (x 1,000,000)"," `(`x 1,000,000`)`","")
str_replace("Total non-residential (x 1,000,000)"," /(x 1,000,000)","")
str_replace("Total non-residential (x 1,000,000)"," /(x 1,000,000/)","")
str_replace("Total non-residential (x 1,000,000)"," \\(x 1,000,000\\)","")
test_1[,COMPONENT:=str_replace(COMPONENT," \\(x 1,000,000\\)","")]
View(test_1)
test_1[,Vector:=NULL]
test_1[,Coordinate:=NULL]
help("reshape")
test_5 <- reshape(test_1,v.names="COMPONENT")
test_5 <- reshape(test_1,v.names="COMPONENT", direction="wide")
test_5 <- reshape(test_1,v.names=COMPONENT, direction="wide")
test_5 <- reshape(test_1,v.names='COMPONENT', direction="wide")
help(cast)
require(reshape2)
help(dcast)
test_5 <- dcast(test_1, Ref_date + GEO + PRICES + NAICS ~ COMPONENT, value.var=Value)
test_5 <- dcast(test_1, Ref_date + GEO + PRICES + NAICS ~ COMPONENT, value.var='Value')
test_5 <- dcast(test_1, Ref_Date + GEO + PRICES + NAICS ~ COMPONENT, value.var='Value')
View(test_5)
unique(test_5[,"NAICS"])
View(NAICS_dic)
View(test_1)
View(test_5)
require(plotly)
View(test_1)
p <- plot_ly(test_5, x="Sofware",y="Ref_Date", type="scatter",mode="lines")
p
p <- plot_ly(test_5, x=~Sofware,y=~Ref_Date, type="scatter",mode="lines")
p
p <- plot_ly(test_5, x=~Software,y=~Ref_Date, type="scatter",mode="lines")
p
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines")
p
test_5[,Software:=as.numeric(Software)]
test_5 <- as.data.table(test_5)
test_5[,Software:=as.numeric(Software)]
View(test_5)
test_5 <- dcast(test_1, Ref_date + GEO + PRICES + NAICS ~ COMPONENT, value.var=Value)
View(test_1)
test_5 <- dcast(test_1, Ref_date + GEO + PRICES + NAICS ~ COMPONENT, value.var="Value")
test_5 <- dcast(test_1, Ref_Date + GEO + PRICES + NAICS ~ COMPONENT, value.var="Value")
View(test_5)
test_1[,Value:=str_replace(Value,"..","NA")]
View(test_1)
test_1 <- fread("flow_stocks_fixed_non_residential_capital.csv")
View(test_1)
test_1 <- test_1[CATEGORY=="Investment"]
View(test_1)
test_1[,COMPONENT:=str_replace(COMPONENT," \\(x 1,000,000\\)","")]
test_1[,Vector:=NULL]
test_1[,Coordinate:=NULL]
View(test_1)
test_1[,Value:=str_replace(Value,"..","NA")]
View(test_1)
test_1 <- fread("flow_stocks_fixed_non_residential_capital.csv")
test_1 <- test_1[CATEGORY=="Investment"]
test_1[,COMPONENT:=str_replace(COMPONENT," \\(x 1,000,000\\)","")]
test_1[,Vector:=NULL]
test_1[,Coordinate:=NULL]
View(test_1)
test_1[,Value:=str_replace(Value,"\\.\\.","NA")]
View(test_1)
test_1[,Value:=as.numeric(Value)]
View(test_1)
test_5 <- dcast(test_1, Ref_Date + GEO + PRICES + NAICS ~ COMPONENT, value.var="Value")
View(test_5)
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines")
p
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", group=NAICS)
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", group="NAICS")
p
help(plotly_data)
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", split="NAICS")
p
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", split=NAICS)
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", legendgroup="NAICS")
p
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", colour=~NAICS)
p
p <- plot_ly(test_5, y=~Software,x=~Ref_Date, type="scatter",mode="lines", color=~NAICS)
p
p <- plot_ly(test_5[PRICES=="2007 constant prices"], y=~Software,x=~Ref_Date, type="scatter",mode="lines", color=~NAICS)
test_5 <- as.data.table(test_5)
p <- plot_ly(test_5[PRICES=="2007 constant prices"], y=~Software,x=~Ref_Date, type="scatter",mode="lines", color=~NAICS)
p
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(test_5)
summary(lm(Software ~ `Computer and electronic products`,data=test_5))
summary(lm(Software ~ `Computer and electronic products`+Ref_Date,data=test_5))
summary(lm(Software ~ `Computer and electronic products`,data=test_5))
summary(lm(Software ~ `Computer and electronic products`,data=test_5[PRICES=="2007 constant prices"]))
summary(lm(Software ~ `Computer and electronic products` +Ref_Date,data=test_5[PRICES=="2007 constant prices"]))
summary(lm(Software ~ `Computer and electronic products` +NAICS,data=test_5[PRICES=="2007 constant prices"]))
p_2 <- plot_ly(test_5[PRICES=="2007 constant prices"],y=~Software, x=~`Computer and electronic products`)
p_2
p_2 <- plot_ly(test_5[PRICES=="2007 constant prices"],y=~Software, x=~`Computer and electronic products`,type="scatter")
p_2
p_2 <- plot_ly(test_5[PRICES=="2007 constant prices" && NAICS !="Total all industries"],y=~Software, x=~`Computer and electronic products`,type="scatter")
p_2
p_2 <- plot_ly(test_5[PRICES=="2007 constant prices" && NAICS !="Total all industries"],y=~Software, x=~`Computer and electronic products`,type="scatter", color=~NAICS)
p_2
head(test_5[PRICES=="2007 constant prices" & NAICS !="Total all industries"])
test_5[PRICES=="2007 constant prices" & NAICS !="Total all industries"]
p_2 <- plot_ly(test_5[PRICES=="2007 constant prices" & NAICS !="Total all industries"],y=~Software, x=~`Computer and electronic products`,type="scatter", color=~NAICS)
p
p_2
